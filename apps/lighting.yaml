global_modules:
  - common.base_app
  - common.utils
  - common.validation

laundry_light:
  module: call_when
  class: CallWhen
  global_dependencies:
    - common.base_app
    - common.validation
  trigger:
    - entity_id: binary_sensor.laundry_room_motion
      state: 'on'
    - entity_id: binary_sensor.server_rack_motion
      state: 'on'
  condition:
    entity_id: switch.laundry_room_lights
    value: 'off'
  call:
    domain: homeassistant
    service: turn_on
    service_data:
      entity_id: switch.laundry_room_lights

laundry_light_timeout:
  module: timeout
  class: Timeout
  global_dependencies:
    - common.base_app
    - common.validation
  trigger:
    - entity_id: switch.laundry_room_lights
  reset_when:
    - entity_id: binary_sensor.kitchen_motion
    - entity_id: binary_sensor.laundry_room_motion
  duration: 10
  on_timeout:
    domain: homeassistant
    service: turn_off
    service_data:
      entity_id: switch.laundry_room_lights

kitchen_light:
  module: call_when
  class: CallWhen
  global_dependencies:
    - common.base_app
    - common.validation
  trigger:
    entity_id: binary_sensor.kitchen_motion
    state: 'on'
  condition:
    entity_id: switch.kitchen_light
    value: 'off'
  call:
    domain: homeassistant
    service: turn_on
    service_data:
      entity_id: switch.kitchen_light

kitchen_light_timeout:
  module: timeout
  class: Timeout
  global_dependencies:
    - common.base_app
    - common.validation
  trigger:
    entity_id: switch.kitchen_light
  reset_when:
    - entity_id: binary_sensor.kitchen_motion
  duration: 40
  on_timeout:
    domain: homeassistant
    service: turn_off
    service_data:
      entity_id: switch.kitchen_light

lower_hall_light:
  module: call_when
  class: CallWhen
  global_dependencies:
    - common.base_app
    - common.validation
  trigger:
    entity_id: binary_sensor.lower_stairs_motion
    state: 'on'
  condition:
    - entity_id: light.entry_light
      value: 'off'
    - entity_id: switch.lower_hall_light
      value: 'off'
  call:
    domain: homeassistant
    service: turn_on
    service_data:
      entity_id:
        - switch.lower_hall_light
        - switch.lower_hall_switch_1
        - switch.lower_hall_switch_2

lower_hall_light_timeout:
  module: timeout
  class: Timeout
  global_dependencies:
    - common.base_app
    - common.validation
  trigger:
    entity_id: switch.lower_hall_light
  reset_when:
    - entity_id: binary_sensor.lower_stairs_motion
  duration: 1
  on_timeout:
    domain: homeassistant
    service: turn_off
    service_data:
      entity_id:
        - switch.lower_hall_light
        - switch.lower_hall_switch_1
        - switch.lower_hall_switch_2

upper_landing_hall_light:
  module: call_when
  class: CallWhen
  global_dependencies:
    - common.base_app
    - common.validation
  trigger:
    entity_id: binary_sensor.upper_landing_motion
    state: 'on'
  condition:
    - entity_id: light.entry_light
      value: 'off'
    - entity_id: switch.upper_landing
      value: 'off'
  call:
    domain: homeassistant
    service: turn_on
    service_data:
      entity_id:
        - switch.upper_landing
        - switch.upper_landing_switch_1
        - switch.upper_landing_switch_2

upper_landing_hall_light_timeout:
  module: timeout
  class: Timeout
  global_dependencies:
    - common.base_app
    - common.validation
  trigger:
    entity_id: switch.upper_landing
  reset_when:
    - entity_id: binary_sensor.upper_landing_motion
  duration: 1
  on_timeout:
    domain: homeassistant
    service: turn_off
    service_data:
      entity_id:
        - switch.upper_landing
        - switch.upper_landing_switch_1
        - switch.upper_landing_switch_2

basement_stair_light:
  module: call_when
  class: CallWhen
  global_dependencies:
    - common.base_app
    - common.validation
  trigger:
    - entity_id: binary_sensor.basement_stairs_motion
      state: 'on'
    - entity_id: binary_sensor.bottom_basement_stairs_motion
      state: 'on'
  condition:
    - entity_id: switch.basement_stair_light
      value: 'off'
  call:
    domain: homeassistant
    service: turn_on
    service_data:
      entity_id:
        - switch.basement_stair_light
        - switch.basement_stair_switch_1
        - switch.basement_stair_switch_2

basement_stair_light_timeout:
  module: timeout
  class: Timeout
  global_dependencies:
    - common.base_app
    - common.validation
  trigger:
    entity_id: switch.basement_stair_light
  reset_when:
    - entity_id: binary_sensor.basement_stairs_motion
    - entity_id: binary_sensor.bottom_basement_stairs_motion
  duration: 1
  on_timeout:
    domain: homeassistant
    service: turn_off
    service_data:
      entity_id:
        - switch.basement_stair_light
        - switch.basement_stair_switch_1
        - switch.basement_stair_switch_2

night_lights:
  module: night_lights
  class: NightLights
  dawn:
    offset: 60
    entities:
      - entity_id: light.entry_light
        domain: light
        service: turn_off
      - entity_id: light.porch_upper
        domain: light
        service: turn_off
      - entity_id: light.porch_lower
        domain: light
        service: turn_off
      - entity_id: light.garage_upper_1
        domain: light
        service: turn_off
      - entity_id: light.garage_upper_2
        domain: light
        service: turn_off
      - entity_id: light.garage_lower_1
        domain: light
        service: turn_off
      - entity_id: light.garage_lower_2
        domain: light
        service: turn_off
  dusk:
    offset: 60
    entities:
      - entity_id: light.entry_light
        domain: light
        service: turn_on
        service_data:
          brightness_pct: 100
      - entity_id: light.porch_upper
        domain: light
        service: turn_on
        service_data:
          brightness_pct: 100
      - entity_id: light.porch_lower
        domain: light
        service: turn_on
        service_data:
          brightness_pct: 100
      - entity_id: light.garage_upper_1
        domain: light
        service: turn_on
        service_data:
          brightness_pct: 100
      - entity_id: light.garage_upper_2
        domain: light
        service: turn_on
        service_data:
          brightness_pct: 100
      - entity_id: light.garage_lower_1
        domain: light
        service: turn_on
        service_data:
          brightness_pct: 100
      - entity_id: light.garage_lower_2
        domain: light
        service: turn_on
        service_data:
          brightness_pct: 100
  night:
    - entity_id: light.entry_light
      domain: light
      service: turn_on
      service_data:
        brightness_pct: 30